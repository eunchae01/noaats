<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<th:block th:fragment="content">

    <!-- Page Header -->
    <div class="page-header d-flex justify-content-between align-items-center flex-wrap gap-2">
        <div>
            <h2><i class="bi bi-receipt me-2"></i>ÏßÄÏ∂ú Í¥ÄÎ¶¨</h2>
            <p>ÏßÄÏ∂ú ÎÇ¥Ïó≠ÏùÑ Í∏∞Î°ùÌïòÍ≥† Í¥ÄÎ¶¨Ìï©ÎãàÎã§</p>
        </div>
        <a th:href="@{/expenses/new}" class="btn btn-primary">
            <i class="bi bi-plus-lg me-1"></i>ÏßÄÏ∂ú Ï∂îÍ∞Ä
        </a>
    </div>

    <!-- Success Message -->
    <div th:if="${message}" class="alert alert-success alert-dismissible fade show" role="alert">
        <i class="bi bi-check-circle me-1"></i>
        <span th:text="${message}"></span>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>

    <!-- Filters -->
    <div class="card mb-4">
        <div class="card-body">
            <form th:action="@{/expenses}" method="get" class="row g-3 align-items-end">
                <div class="col-md-3">
                    <label class="form-label">ÏãúÏûëÏùº</label>
                    <input type="date" class="form-control" name="startDate"
                           th:value="${startDate}">
                </div>
                <div class="col-md-3">
                    <label class="form-label">Ï¢ÖÎ£åÏùº</label>
                    <input type="date" class="form-control" name="endDate"
                           th:value="${endDate}">
                </div>
                <div class="col-md-3">
                    <label class="form-label">Ïπ¥ÌÖåÍ≥†Î¶¨</label>
                    <select class="form-select" name="category">
                        <option value="">Ï†ÑÏ≤¥</option>
                        <option th:each="cat : ${categories}"
                                th:value="${cat}"
                                th:text="${cat.displayName}"
                                th:selected="${category != null && category == cat}">
                        </option>
                    </select>
                </div>
                <div class="col-md-3">
                    <button type="submit" class="btn btn-primary w-100">
                        <i class="bi bi-search me-1"></i>Í≤ÄÏÉâ
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Summary Bar -->
    <div class="d-flex justify-content-between align-items-center mb-3 px-1">
        <span class="text-secondary">
            Ï¥ù <strong th:text="${expenses.totalElements}">0</strong>Í±¥ |
            Ìï©Í≥Ñ <strong class="amount"
                        th:text="${#numbers.formatDecimal(totalAmount, 0, 'COMMA', 0, 'POINT')} + 'Ïõê'">0Ïõê</strong>
        </span>
    </div>

    <!-- Expenses Table -->
    <div class="card">
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover mb-0">
                    <thead>
                        <tr>
                            <th class="text-center">ÎÇ†Ïßú</th>
                            <th class="text-center">Ïπ¥ÌÖåÍ≥†Î¶¨</th>
                            <th class="text-center">ÏÑ§Î™Ö</th>
                            <th class="text-center">Î©îÎ™®</th>
                            <th class="text-end">Í∏àÏï°</th>
                            <th class="text-center" style="width: 120px;">Í¥ÄÎ¶¨</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="expense : ${expenses.content}">
                            <td class="text-center" th:text="${#temporals.format(expense.expenseDate, 'yyyy-MM-dd')}"></td>
                            <td class="text-center">
                                <span class="badge badge-category"
                                      th:classappend="'badge-' + ${expense.category.name().toLowerCase() == 'food' ? 'food' :
                                                     expense.category.name().toLowerCase() == 'transport' ? 'transport' :
                                                     expense.category.name().toLowerCase() == 'entertainment' ? 'entertainment' :
                                                     expense.category.name().toLowerCase() == 'housing' ? 'housing' :
                                                     expense.category.name().toLowerCase() == 'shopping' ? 'shopping' :
                                                     expense.category.name().toLowerCase() == 'health' ? 'health' :
                                                     expense.category.name().toLowerCase() == 'education' ? 'education' : 'other'}"
                                      th:text="${expense.category.displayName}"></span>
                            </td>
                            <td class="text-center" th:text="${expense.description}"></td>
                            <td class="text-center text-muted small" th:text="${expense.memo}"></td>
                            <td class="text-end amount"
                                th:text="${#numbers.formatDecimal(expense.amount, 0, 'COMMA', 0, 'POINT')} + 'Ïõê'"></td>
                            <td class="text-center">
                                <a th:href="@{/expenses/{id}/edit(id=${expense.id})}"
                                   class="btn btn-outline-primary btn-sm me-1" title="ÏàòÏ†ï">
                                    <i class="bi bi-pencil"></i>
                                </a>
                                <form th:action="@{/expenses/{id}/delete(id=${expense.id})}"
                                      method="post" class="d-inline"
                                      onsubmit="return confirm('Ï†ïÎßê ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?');">
                                    <button type="submit" class="btn btn-outline-danger btn-sm" title="ÏÇ≠Ï†ú">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </form>
                            </td>
                        </tr>
                        <!-- Empty State -->
                        <tr th:if="${expenses.content.isEmpty()}">
                            <td colspan="6">
                                <div class="empty-state">
                                    <div class="empty-icon">üìù</div>
                                    <p>Îì±Î°ùÎêú ÏßÄÏ∂ú ÎÇ¥Ïó≠Ïù¥ ÏóÜÏäµÎãàÎã§</p>
                                    <a th:href="@{/expenses/new}" class="btn btn-primary btn-sm">
                                        <i class="bi bi-plus-lg me-1"></i>Ï≤´ ÏßÄÏ∂ú Îì±Î°ùÌïòÍ∏∞
                                    </a>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Pagination -->
    <nav th:if="${expenses.totalPages > 1}" class="mt-3 d-flex justify-content-center">
        <ul class="pagination pagination-sm">
            <li class="page-item" th:classappend="${expenses.first} ? 'disabled'">
                <a class="page-link"
                   th:href="@{/expenses(startDate=${startDate}, endDate=${endDate}, category=${category}, page=${expenses.number - 1})}">&laquo;</a>
            </li>
            <li th:each="i : ${#numbers.sequence(0, expenses.totalPages - 1)}"
                class="page-item"
                th:classappend="${i == expenses.number} ? 'active'">
                <a class="page-link"
                   th:href="@{/expenses(startDate=${startDate}, endDate=${endDate}, category=${category}, page=${i})}"
                   th:text="${i + 1}"></a>
            </li>
            <li class="page-item" th:classappend="${expenses.last} ? 'disabled'">
                <a class="page-link"
                   th:href="@{/expenses(startDate=${startDate}, endDate=${endDate}, category=${category}, page=${expenses.number + 1})}">&raquo;</a>
            </li>
        </ul>
    </nav>

</th:block>

<th:block th:fragment="scripts">
    <!-- Ïù¥ ÌéòÏù¥ÏßÄÎäî Ï∂îÍ∞Ä Ïä§ÌÅ¨Î¶ΩÌä∏ ÏóÜÏùå -->
</th:block>

</html>
